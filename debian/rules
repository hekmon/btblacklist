#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
export DH_VERBOSE=1

# Dir vars
export GOPATH := ${CURDIR}/../..
DEBIAN_DIR = $(CURDIR)/debian

%:
	dh $@ --with systemd

override_dh_auto_clean:
	rm -rf $(GOPATH)/bin/* $(GOPATH)/pkg/*
	cd $(GOPATH)/src && find * -name '*.go' -exec dirname {} \; | xargs -n1 go clean

override_dh_auto_build:
	echo $(PATH)
	go build -v -ldflags "-s -w"

# override_dh_auto_test:
# 	go test -v

override_dh_usrlocal:

override_dh_systemd_start:
	dh_systemd_start  --no-start --name=btblocklist
override_dh_systemd_enable:
	dh_systemd_enable --name=btblocklist

clean:
	-rm -r ${GOPATH}/src/btblocklist/btblocklist
	-rm ${DEBIAN_DIR}/btblocklist.debhelper.log
	-rm ${DEBIAN_DIR}/btblocklist.postinst.debhelper
	-rm ${DEBIAN_DIR}/btblocklist.postrm.debhelper
	-rm ${DEBIAN_DIR}/btblocklist.prerm.debhelper
	-rm ${DEBIAN_DIR}/btblocklist.substvars
	-rm ${DEBIAN_DIR}/files
